<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Istio | Sidecar iptables and traffic steering detail :: apcj@f5 blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="How istio manipulates the traffic." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/istio-traffic-control-deepdive/" />




<link rel="stylesheet" href="/assets/style.css">






<link rel="apple-touch-icon" href="/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="/img/favicon/orange.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Istio | Sidecar iptables and traffic steering detail">
<meta property="og:description" content="How istio manipulates the traffic." />
<meta property="og:url" content="/posts/istio-traffic-control-deepdive/" />
<meta property="og:site_name" content="apcj@f5 blog" />

  
    <meta property="og:image" content="/img/favicon/orange.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2020-06-25 00:00:00 &#43;0000 UTC" />












</head>
<body class="orange">


<div class="container full headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    apcj@f5
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/posts">Posts</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/tags">Tags</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/posts">Posts</a></li>
      
    
      
        <li><a href="/tags">Tags</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/posts/istio-traffic-control-deepdive/">Istio | Sidecar iptables and traffic steering detail</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2020-06-25
        
          [Updated: 2020-06-25]
        
      </span>
    
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="/tags/istio/">istio</a>&nbsp;
    
    #<a href="/tags/envoy/">envoy</a>&nbsp;
    
  </span>
  
  


  

  <div class="post-content"><div>
        <h2 id="istio-injected-iptables">Istio injected iptables<a href="#istio-injected-iptables" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Istio implements the hijacking and processing of traffic by injecting the init container and envoy proxy container into the business pod. After the init container runs, the following NAT table rules for iptables will be generated in the corresponding linux namespace</p>
<pre tabindex="0"><code>&amp;#91;root@k8s-node1-v1-16 ~]# iptables -t nat -L -v
Chain PREROUTING (policy ACCEPT 192K packets, 12M bytes)
 pkts bytes target     prot opt in     out     source               destination
 192K   12M ISTIO_INBOUND  tcp  --  any    any     anywhere             anywhere

Chain INPUT (policy ACCEPT 192K packets, 12M bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 40673 packets, 3694K bytes)
 pkts bytes target     prot opt in     out     source               destination
 8917  535K ISTIO_OUTPUT  tcp  --  any    any     anywhere             anywhere

Chain POSTROUTING (policy ACCEPT 40673 packets, 3694K bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain ISTIO_INBOUND (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:ssh
  356 21360 RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:15090
 192K   11M RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:15021
    0     0 RETURN     tcp  --  any    any     anywhere             anywhere             tcp dpt:15020
   34  2040 ISTIO_IN_REDIRECT  tcp  --  any    any     anywhere             anywhere

Chain ISTIO_IN_REDIRECT (3 references)
 pkts bytes target     prot opt in     out     source               destination
   34  2040 REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports 15006

Chain ISTIO_OUTPUT (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 RETURN     all  --  any    lo      127.0.0.6            anywhere    
    0     0 ISTIO_IN_REDIRECT  all  --  any    lo      anywhere            !localhost            owner UID match 1337
    0     0 RETURN     all  --  any    lo      anywhere             anywhere             ! owner UID match 1337
 8917  535K RETURN     all  --  any    any     anywhere             anywhere             owner UID match 1337
    0     0 ISTIO_IN_REDIRECT  all  --  any    lo      anywhere            !localhost            owner GID match 1337
    0     0 RETURN     all  --  any    lo      anywhere             anywhere             ! owner GID match 1337
    0     0 RETURN     all  --  any    any     anywhere             anywhere             owner GID match 1337
    0     0 RETURN     all  --  any    any     anywhere             localhost
    0     0 ISTIO_REDIRECT  all  --  any    any     anywhere             anywhere

Chain ISTIO_REDIRECT (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports 15001
</code></pre><h2 id="outbound-flow-control">Outbound flow control<a href="#outbound-flow-control" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>When the business container sends the request to the outside, such as productpage to reviews: 9080 port access, this connection will be redirected by iptables to port 127.0.0.1:115001, and then processed by envoy.</p>
<blockquote>
<p>REDIRECT
This target is only valid in the nat table, in the PREROUTING and OUTPUT chains, and user-defined chains which are only called from those chains. It redirects the packet to the machine itself by changing the destination IP to the primary address of the incoming interface (locally-generated packets are mapped to the localhost address, 127.0.0.1 for IPv4 and ::1 for IPv6).</p>
<p><a href="https://ipset.netfilter.org/iptables-extensions.man.html#lbDK">https://ipset.netfilter.org/iptables-extensions.man.html#lbDK</a></p>
</blockquote>
<p>The virtualOutbound in envoy will be hit. This is a special listener. It contains the Original Destination listener filter. Note &ldquo;useOriginalDst&rdquo;: truethat after such configuration in the following configuration , envoy will re-find the matching listener in the configuration. If found, press the hit. The listener performs follow-up processing. If it cannot find it, it sends the request to the cluster in this listener. Here is a passthrough cluster. This cluster will forward the packet directly to the fourth layer.</p>
<pre tabindex="0"><code>root@k8s-master-v1-16 ~]# istioctl proxy-config listener productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo --port 15001 -o json
&amp;#91;
    {
        &quot;name&quot;: &quot;virtualOutbound&quot;,
        &quot;address&quot;: {
            &quot;socketAddress&quot;: {
                &quot;address&quot;: &quot;0.0.0.0&quot;,
                &quot;portValue&quot;: 15001
            }
        },
        &quot;filterChains&quot;: &amp;#91;
            {
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.stats&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm&quot;,
                            &quot;value&quot;: {
                                &quot;config&quot;: {
                                    &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                    &quot;root_id&quot;: &quot;stats_outbound&quot;,
                                    &quot;vm_config&quot;: {
                                        &quot;code&quot;: {
                                            &quot;local&quot;: {
                                                &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                            }
                                        },
                                        &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                        &quot;vm_id&quot;: &quot;tcp_stats_outbound&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.tcp_proxy&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.tcp_proxy.v2.TcpProxy&quot;,
                            &quot;statPrefix&quot;: &quot;PassthroughCluster&quot;,
                            &quot;cluster&quot;: &quot;PassthroughCluster&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ]
                        }
                    }
                ],
                &quot;name&quot;: &quot;virtualOutbound-catchall-tcp&quot;
            }
        ],
        &quot;useOriginalDst&quot;: true,
        &quot;trafficDirection&quot;: &quot;OUTBOUND&quot;
    }
]
</code></pre><p>The above listener will hand over the connection to the listener that matches the original destination IP and port. In the bookinfo example, it will be handed over to the 9080 listener. There is a question to consider here. From the perspective of envoy, the destination port of this link is already 15001, why can it match the following port 0.0.0.0:9080. This is because the NAT is done in the system kernel when iptables is redirected. The system kernel has this converted storage. Envoy obtains the real destination port through getsockopt() , so that it can correctly match the business listener.</p>
<pre tabindex="0"><code>&amp;#91;root@k8s-master-v1-16 ~]# istioctl proxy-config listener productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo --port 9080 -o json
&amp;#91;
    {
        &quot;name&quot;: &quot;0.0.0.0_9080&quot;,
        &quot;address&quot;: {
            &quot;socketAddress&quot;: {
                &quot;address&quot;: &quot;0.0.0.0&quot;,
                &quot;portValue&quot;: 9080
            }
        },
        &quot;filterChains&quot;: &amp;#91;
            {
                &quot;filterChainMatch&quot;: {
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;http/1.0&quot;,
                        &quot;http/1.1&quot;,
                        &quot;h2c&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;outbound_0.0.0.0_9080&quot;,
                            &quot;rds&quot;: {
                                &quot;configSource&quot;: {
                                    &quot;ads&quot;: {}
                                },
                                &quot;routeConfigName&quot;: &quot;9080&quot;
                            },
</code></pre><pre tabindex="0"><code>&amp;#91;root@k8s-master-v1-16 ~]# istioctl proxy-config listener productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo
ADDRESS            PORT      TYPE
10.102.252.88      15012     TCP
10.96.122.225      31400     TCP
10.96.0.10         53        TCP
10.110.88.185      15443     TCP
10.96.122.225      15443     TCP
10.110.88.185      443       TCP
10.102.252.88      443       TCP
10.106.109.172     9001      TCP
10.96.0.1          443       TCP
10.96.122.225      443       TCP
10.106.109.172     9000      TCP
10.105.130.171     14267     HTTP+TCP
10.96.81.27        5601      HTTP+TCP
0.0.0.0            15014     HTTP+TCP
10.105.130.171     14250     HTTP+TCP
0.0.0.0            20001     HTTP+TCP
0.0.0.0            9411      HTTP+TCP
10.111.37.34       9090      HTTP+TCP
10.105.145.36      80        HTTP+TCP
10.105.130.171     14268     HTTP+TCP
10.96.0.10         9153      HTTP+TCP
10.110.244.188     80        HTTP+TCP
10.102.252.88      853       HTTP+TCP
10.99.139.251      16686     HTTP+TCP
0.0.0.0            12345     HTTP+TCP
10.103.155.149     80        HTTP+TCP
0.0.0.0            8000      HTTP+TCP
0.0.0.0            15010     HTTP+TCP
10.96.122.225      15020     HTTP+TCP
0.0.0.0            9090      HTTP+TCP
10.107.150.251     80        HTTP+TCP
0.0.0.0            14250     HTTP+TCP
0.0.0.0            80        HTTP+TCP
0.0.0.0            3000      HTTP+TCP
10.110.28.96       8181      HTTP+TCP
10.102.69.143      9200      HTTP+TCP
0.0.0.0            9080      HTTP+TCP 《《《《《《《《《《《《
0.0.0.0            15001     TCP 《《《《《《《《《《《《
0.0.0.0            15006     HTTP+TCP
0.0.0.0            15090     HTTP
0.0.0.0            15021     HTTP
</code></pre><p>Related passthrough cluster:</p>
<pre tabindex="0"><code>root@k8s-master-v1-16 ~]# istioctl proxy-config cluster productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo --fqdn PassthroughCluster -o json
&amp;#91;
。。。。忽略。。。
    {
        &quot;name&quot;: &quot;PassthroughCluster&quot;,
        &quot;type&quot;: &quot;ORIGINAL_DST&quot;,
        &quot;connectTimeout&quot;: &quot;10s&quot;,
        &quot;lbPolicy&quot;: &quot;CLUSTER_PROVIDED&quot;,
        &quot;circuitBreakers&quot;: {
            &quot;thresholds&quot;: &amp;#91;
                {
                    &quot;maxConnections&quot;: 4294967295,
                    &quot;maxPendingRequests&quot;: 4294967295,
                    &quot;maxRequests&quot;: 4294967295,
                    &quot;maxRetries&quot;: 4294967295
                }
            ]
        },
        &quot;filters&quot;: &amp;#91;
            {
                &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                &quot;typedConfig&quot;: {
                    &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                    &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                    &quot;value&quot;: {
                        &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                    }
                }
            }
        ]
    }
]
</code></pre><h2 id="inbound-flow-control">Inbound flow control<a href="#inbound-flow-control" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>When it is an inbound request, the destination address of the packet is the IP of the pod, and the destination port is the real port of the business (9080, non-svc mapping port). Since the link destination port of iptables is changed to 15006, it will Hit virtual inbound listener (0.0.0.0:15006), this listener has a series of filterchain, and the virtualoutbound listener configuration method is different, virtualinbound contains a series of actual service filters for specific ports, the connection will find specific in these fitlers Business matching. So how does it match the real 9080 business? For example, the following output:
addressPrefix can be matched. If the pod actually has multiple ports, only addressPrefix does not match. It also needs to match the application layer protocol, but the DestinationPort in the Match condition is not matched . In fact, it is similar to Virtualoutbound. The filter of the original destination listener is also used, so envoy will obtain the real destination port and IP from the kernel. This configuration method is different from the virtual outbound &ldquo;useOriginalDst&rdquo;: true configuration method, because this is an updated configuration method.&quot; useOriginalDst&quot;: true This configuration is about to be abandoned.</p>
<p><code>&quot;listenerFilters&quot;: [ { &quot;name&quot;: &quot;envoy.listener.original_dst&quot;, &quot;typedConfig&quot;: { &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.listener.original_dst.v2.OriginalDst&quot; } },</code></p>
<p>(According to <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/listener/listener_components.proto">https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/listener/listener_components.proto</a>, the  filtermatch condition is that all must match)</p>
<pre tabindex="0"><code>            {
                &quot;filterChainMatch&quot;: {
                    &quot;destinationPort&quot;: 9080,
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;10.244.2.138&quot;,
                            &quot;prefixLen&quot;: 32
                        }
                    ],
### 根据https://istio.io/latest/zh/docs/ops/deployment/requirements/ , 
### 同一个业务端口是不能被两个用不同协议的svc来发布的，因此这帮助避免了同端口同协议的match在整个配置文件里的出现。
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;istio&quot;,
                        &quot;istio-http/1.0&quot;,
                        &quot;istio-http/1.1&quot;,
                        &quot;istio-h2&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;inbound_10.244.2.138_9080&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|9080&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;productpage.istio-bookinfo.svc.cluster.local:9080/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
</code></pre><h2 id="last">Last<a href="#last" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Attach the actual configuration of 15006</p>
<pre tabindex="0"><code>&amp;#91;root@k8s-master-v1-16 ~]# istioctl proxy-config listener productpage-v1-7f4cc988c6-qxqjs.istio-bookinfo --port 15006 -o json
&amp;#91;
    {
        &quot;name&quot;: &quot;virtualInbound&quot;,
        &quot;address&quot;: {
            &quot;socketAddress&quot;: {
                &quot;address&quot;: &quot;0.0.0.0&quot;,
                &quot;portValue&quot;: 15006
            }
        },
        &quot;filterChains&quot;: &amp;#91;
            {
                &quot;filterChainMatch&quot;: {
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;0.0.0.0&quot;,
                            &quot;prefixLen&quot;: 0
                        }
                    ],
                    &quot;transportProtocol&quot;: &quot;tls&quot;,
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;istio-peer-exchange&quot;,
                        &quot;istio&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;istio.stats&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm&quot;,
                            &quot;value&quot;: {
                                &quot;config&quot;: {
                                    &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                    &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                    &quot;vm_config&quot;: {
                                        &quot;code&quot;: {
                                            &quot;local&quot;: {
                                                &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                            }
                                        },
                                        &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                        &quot;vm_id&quot;: &quot;tcp_stats_inbound&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.tcp_proxy&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.tcp_proxy.v2.TcpProxy&quot;,
                            &quot;statPrefix&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;cluster&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ]
                        }
                    }
                ],
                &quot;transportSocket&quot;: {
                    &quot;name&quot;: &quot;envoy.transport_sockets.tls&quot;,
                    &quot;typedConfig&quot;: {
                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.api.v2.auth.DownstreamTlsContext&quot;,
                        &quot;commonTlsContext&quot;: {
                            &quot;tlsCertificateSdsSecretConfigs&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;default&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            ],
                            &quot;combinedValidationContext&quot;: {
                                &quot;defaultValidationContext&quot;: {},
                                &quot;validationContextSdsSecretConfig&quot;: {
                                    &quot;name&quot;: &quot;ROOTCA&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            &quot;alpnProtocols&quot;: &amp;#91;
                                &quot;istio-peer-exchange&quot;,
                                &quot;h2&quot;,
                                &quot;http/1.1&quot;
                            ]
                        },
                        &quot;requireClientCertificate&quot;: true
                    }
                },
                &quot;name&quot;: &quot;virtualInbound&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;0.0.0.0&quot;,
                            &quot;prefixLen&quot;: 0
                        }
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;istio.stats&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm&quot;,
                            &quot;value&quot;: {
                                &quot;config&quot;: {
                                    &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                    &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                    &quot;vm_config&quot;: {
                                        &quot;code&quot;: {
                                            &quot;local&quot;: {
                                                &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                            }
                                        },
                                        &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                        &quot;vm_id&quot;: &quot;tcp_stats_inbound&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.tcp_proxy&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.tcp_proxy.v2.TcpProxy&quot;,
                            &quot;statPrefix&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;cluster&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ]
                        }
                    }
                ],
                &quot;name&quot;: &quot;virtualInbound&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;0.0.0.0&quot;,
                            &quot;prefixLen&quot;: 0
                        }
                    ],
                    &quot;transportProtocol&quot;: &quot;tls&quot;,
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;http/1.0&quot;,
                        &quot;http/1.1&quot;,
                        &quot;h2c&quot;,
                        &quot;istio-http/1.0&quot;,
                        &quot;istio-http/1.1&quot;,
                        &quot;istio-h2&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|0&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;:0/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
                                &quot;validateClusters&quot;: false
                            },
                            &quot;httpFilters&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{}\n&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.metadata_exchange&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.cors&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.cors.v2.Cors&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.fault&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.fault.v2.HTTPFault&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio.stats&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                                &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                                    &quot;vm_id&quot;: &quot;stats_inbound&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.router&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.router.v2.Router&quot;
                                    }
                                }
                            ],
                            &quot;tracing&quot;: {
                                &quot;clientSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;randomSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;overallSampling&quot;: {
                                    &quot;value&quot;: 100
                                }
                            },
                            &quot;serverName&quot;: &quot;istio-envoy&quot;,
                            &quot;streamIdleTimeout&quot;: &quot;0s&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ],
                            &quot;useRemoteAddress&quot;: false,
                            &quot;generateRequestId&quot;: true,
                            &quot;forwardClientCertDetails&quot;: &quot;APPEND_FORWARD&quot;,
                            &quot;setCurrentClientCertDetails&quot;: {
                                &quot;subject&quot;: true,
                                &quot;dns&quot;: true,
                                &quot;uri&quot;: true
                            },
                            &quot;upgradeConfigs&quot;: &amp;#91;
                                {
                                    &quot;upgradeType&quot;: &quot;websocket&quot;
                                }
                            ],
                            &quot;normalizePath&quot;: true
                        }
                    }
                ],
                &quot;transportSocket&quot;: {
                    &quot;name&quot;: &quot;envoy.transport_sockets.tls&quot;,
                    &quot;typedConfig&quot;: {
                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.api.v2.auth.DownstreamTlsContext&quot;,
                        &quot;commonTlsContext&quot;: {
                            &quot;tlsCertificateSdsSecretConfigs&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;default&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            ],
                            &quot;combinedValidationContext&quot;: {
                                &quot;defaultValidationContext&quot;: {},
                                &quot;validationContextSdsSecretConfig&quot;: {
                                    &quot;name&quot;: &quot;ROOTCA&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            &quot;alpnProtocols&quot;: &amp;#91;
                                &quot;h2&quot;,
                                &quot;http/1.1&quot;
                            ]
                        },
                        &quot;requireClientCertificate&quot;: true
                    }
                },
                &quot;name&quot;: &quot;virtualInbound-catchall-http&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;0.0.0.0&quot;,
                            &quot;prefixLen&quot;: 0
                        }
                    ],
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;http/1.0&quot;,
                        &quot;http/1.1&quot;,
                        &quot;h2c&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|0&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;InboundPassthroughClusterIpv4&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;:0/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
                                &quot;validateClusters&quot;: false
                            },
                            &quot;httpFilters&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{}\n&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.metadata_exchange&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.cors&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.cors.v2.Cors&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.fault&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.fault.v2.HTTPFault&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio.stats&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                                &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                                    &quot;vm_id&quot;: &quot;stats_inbound&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.router&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.router.v2.Router&quot;
                                    }
                                }
                            ],
                            &quot;tracing&quot;: {
                                &quot;clientSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;randomSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;overallSampling&quot;: {
                                    &quot;value&quot;: 100
                                }
                            },
                            &quot;serverName&quot;: &quot;istio-envoy&quot;,
                            &quot;streamIdleTimeout&quot;: &quot;0s&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ],
                            &quot;useRemoteAddress&quot;: false,
                            &quot;generateRequestId&quot;: true,
                            &quot;forwardClientCertDetails&quot;: &quot;APPEND_FORWARD&quot;,
                            &quot;setCurrentClientCertDetails&quot;: {
                                &quot;subject&quot;: true,
                                &quot;dns&quot;: true,
                                &quot;uri&quot;: true
                            },
                            &quot;upgradeConfigs&quot;: &amp;#91;
                                {
                                    &quot;upgradeType&quot;: &quot;websocket&quot;
                                }
                            ],
                            &quot;normalizePath&quot;: true
                        }
                    }
                ],
                &quot;name&quot;: &quot;virtualInbound-catchall-http&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;destinationPort&quot;: 15021,
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;10.244.2.155&quot;,
                            &quot;prefixLen&quot;: 32
                        }
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;istio.stats&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm&quot;,
                            &quot;value&quot;: {
                                &quot;config&quot;: {
                                    &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                    &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                    &quot;vm_config&quot;: {
                                        &quot;code&quot;: {
                                            &quot;local&quot;: {
                                                &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                            }
                                        },
                                        &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                        &quot;vm_id&quot;: &quot;tcp_stats_inbound&quot;
                                    }
                                }
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.tcp_proxy&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.tcp_proxy.v2.TcpProxy&quot;,
                            &quot;statPrefix&quot;: &quot;inbound|15021|mgmt-15021|mgmtCluster&quot;,
                            &quot;cluster&quot;: &quot;inbound|15021|mgmt-15021|mgmtCluster&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ]
                        }
                    }
                ],
                &quot;name&quot;: &quot;10.244.2.155_15021&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;destinationPort&quot;: 9080,
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;10.244.2.155&quot;,
                            &quot;prefixLen&quot;: 32
                        }
                    ],
                    &quot;applicationProtocols&quot;: &amp;#91;
                        &quot;istio&quot;,
                        &quot;istio-http/1.0&quot;,
                        &quot;istio-http/1.1&quot;,
                        &quot;istio-h2&quot;
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;inbound_10.244.2.155_9080&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|9080&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;productpage.istio-bookinfo.svc.cluster.local:9080/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
                                &quot;validateClusters&quot;: false
                            },
                            &quot;httpFilters&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{}\n&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.metadata_exchange&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio_authn&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/istio.envoy.config.filter.http.authn.v2alpha1.FilterConfig&quot;,
                                        &quot;policy&quot;: {
                                            &quot;peers&quot;: &amp;#91;
                                                {
                                                    &quot;mtls&quot;: {
                                                        &quot;mode&quot;: &quot;PERMISSIVE&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.cors&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.cors.v2.Cors&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.fault&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.fault.v2.HTTPFault&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio.stats&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                                &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                                    &quot;vm_id&quot;: &quot;stats_inbound&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.router&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.router.v2.Router&quot;
                                    }
                                }
                            ],
                            &quot;tracing&quot;: {
                                &quot;clientSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;randomSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;overallSampling&quot;: {
                                    &quot;value&quot;: 100
                                }
                            },
                            &quot;serverName&quot;: &quot;istio-envoy&quot;,
                            &quot;streamIdleTimeout&quot;: &quot;0s&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ],
                            &quot;useRemoteAddress&quot;: false,
                            &quot;generateRequestId&quot;: true,
                            &quot;forwardClientCertDetails&quot;: &quot;APPEND_FORWARD&quot;,
                            &quot;setCurrentClientCertDetails&quot;: {
                                &quot;subject&quot;: true,
                                &quot;dns&quot;: true,
                                &quot;uri&quot;: true
                            },
                            &quot;upgradeConfigs&quot;: &amp;#91;
                                {
                                    &quot;upgradeType&quot;: &quot;websocket&quot;
                                }
                            ],
                            &quot;normalizePath&quot;: true
                        }
                    }
                ],
                &quot;transportSocket&quot;: {
                    &quot;name&quot;: &quot;envoy.transport_sockets.tls&quot;,
                    &quot;typedConfig&quot;: {
                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.api.v2.auth.DownstreamTlsContext&quot;,
                        &quot;commonTlsContext&quot;: {
                            &quot;tlsCertificateSdsSecretConfigs&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;default&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            ],
                            &quot;combinedValidationContext&quot;: {
                                &quot;defaultValidationContext&quot;: {},
                                &quot;validationContextSdsSecretConfig&quot;: {
                                    &quot;name&quot;: &quot;ROOTCA&quot;,
                                    &quot;sdsConfig&quot;: {
                                        &quot;apiConfigSource&quot;: {
                                            &quot;apiType&quot;: &quot;GRPC&quot;,
                                            &quot;grpcServices&quot;: &amp;#91;
                                                {
                                                    &quot;envoyGrpc&quot;: {
                                                        &quot;clusterName&quot;: &quot;sds-grpc&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            &quot;alpnProtocols&quot;: &amp;#91;
                                &quot;h2&quot;,
                                &quot;http/1.1&quot;
                            ]
                        },
                        &quot;requireClientCertificate&quot;: true
                    }
                },
                &quot;name&quot;: &quot;10.244.2.155_9080&quot;
            },
            {
                &quot;filterChainMatch&quot;: {
                    &quot;destinationPort&quot;: 9080,
                    &quot;prefixRanges&quot;: &amp;#91;
                        {
                            &quot;addressPrefix&quot;: &quot;10.244.2.155&quot;,
                            &quot;prefixLen&quot;: 32
                        }
                    ]
                },
                &quot;filters&quot;: &amp;#91;
                    {
                        &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                            &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;,
                            &quot;value&quot;: {
                                &quot;protocol&quot;: &quot;istio-peer-exchange&quot;
                            }
                        }
                    },
                    {
                        &quot;name&quot;: &quot;envoy.http_connection_manager&quot;,
                        &quot;typedConfig&quot;: {
                            &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.network.http_connection_manager.v2.HttpConnectionManager&quot;,
                            &quot;statPrefix&quot;: &quot;inbound_10.244.2.155_9080&quot;,
                            &quot;routeConfig&quot;: {
                                &quot;name&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                &quot;virtualHosts&quot;: &amp;#91;
                                    {
                                        &quot;name&quot;: &quot;inbound|http|9080&quot;,
                                        &quot;domains&quot;: &amp;#91;
                                            &quot;*&quot;
                                        ],
                                        &quot;routes&quot;: &amp;#91;
                                            {
                                                &quot;name&quot;: &quot;default&quot;,
                                                &quot;match&quot;: {
                                                    &quot;prefix&quot;: &quot;/&quot;
                                                },
                                                &quot;route&quot;: {
                                                    &quot;cluster&quot;: &quot;inbound|9080|http|productpage.istio-bookinfo.svc.cluster.local&quot;,
                                                    &quot;timeout&quot;: &quot;0s&quot;,
                                                    &quot;maxGrpcTimeout&quot;: &quot;0s&quot;
                                                },
                                                &quot;decorator&quot;: {
                                                    &quot;operation&quot;: &quot;productpage.istio-bookinfo.svc.cluster.local:9080/*&quot;
                                                }
                                            }
                                        ]
                                    }
                                ],
                                &quot;validateClusters&quot;: false
                            },
                            &quot;httpFilters&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;istio.metadata_exchange&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{}\n&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.metadata_exchange&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio_authn&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/istio.envoy.config.filter.http.authn.v2alpha1.FilterConfig&quot;,
                                        &quot;policy&quot;: {
                                            &quot;peers&quot;: &amp;#91;
                                                {
                                                    &quot;mtls&quot;: {
                                                        &quot;mode&quot;: &quot;PERMISSIVE&quot;
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.cors&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.cors.v2.Cors&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.fault&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.fault.v2.HTTPFault&quot;
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;istio.stats&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;,
                                        &quot;typeUrl&quot;: &quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;,
                                        &quot;value&quot;: {
                                            &quot;config&quot;: {
                                                &quot;configuration&quot;: &quot;{\n  \&quot;debug\&quot;: \&quot;false\&quot;,\n  \&quot;stat_prefix\&quot;: \&quot;istio\&quot;\n}\n&quot;,
                                                &quot;root_id&quot;: &quot;stats_inbound&quot;,
                                                &quot;vm_config&quot;: {
                                                    &quot;code&quot;: {
                                                        &quot;local&quot;: {
                                                            &quot;inline_string&quot;: &quot;envoy.wasm.stats&quot;
                                                        }
                                                    },
                                                    &quot;runtime&quot;: &quot;envoy.wasm.runtime.null&quot;,
                                                    &quot;vm_id&quot;: &quot;stats_inbound&quot;
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    &quot;name&quot;: &quot;envoy.router&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.http.router.v2.Router&quot;
                                    }
                                }
                            ],
                            &quot;tracing&quot;: {
                                &quot;clientSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;randomSampling&quot;: {
                                    &quot;value&quot;: 100
                                },
                                &quot;overallSampling&quot;: {
                                    &quot;value&quot;: 100
                                }
                            },
                            &quot;serverName&quot;: &quot;istio-envoy&quot;,
                            &quot;streamIdleTimeout&quot;: &quot;0s&quot;,
                            &quot;accessLog&quot;: &amp;#91;
                                {
                                    &quot;name&quot;: &quot;envoy.file_access_log&quot;,
                                    &quot;typedConfig&quot;: {
                                        &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.accesslog.v2.FileAccessLog&quot;,
                                        &quot;path&quot;: &quot;/dev/stdout&quot;,
                                        &quot;format&quot;: &quot;&amp;#91;%START_TIME%] \&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% \&quot;%DYNAMIC_METADATA(istio.mixer:status)%\&quot; \&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \&quot;%REQ(X-FORWARDED-FOR)%\&quot; \&quot;%REQ(USER-AGENT)%\&quot; \&quot;%REQ(X-REQUEST-ID)%\&quot; \&quot;%REQ(:AUTHORITY)%\&quot; \&quot;%UPSTREAM_HOST%\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\n&quot;
                                    }
                                }
                            ],
                            &quot;useRemoteAddress&quot;: false,
                            &quot;generateRequestId&quot;: true,
                            &quot;forwardClientCertDetails&quot;: &quot;APPEND_FORWARD&quot;,
                            &quot;setCurrentClientCertDetails&quot;: {
                                &quot;subject&quot;: true,
                                &quot;dns&quot;: true,
                                &quot;uri&quot;: true
                            },
                            &quot;upgradeConfigs&quot;: &amp;#91;
                                {
                                    &quot;upgradeType&quot;: &quot;websocket&quot;
                                }
                            ],
                            &quot;normalizePath&quot;: true
                        }
                    }
                ],
                &quot;name&quot;: &quot;10.244.2.155_9080&quot;
            }
        ],
        &quot;listenerFilters&quot;: &amp;#91;
            {
                &quot;name&quot;: &quot;envoy.listener.original_dst&quot;,
                &quot;typedConfig&quot;: {
                    &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.listener.original_dst.v2.OriginalDst&quot;
                }
            },
            {
                &quot;name&quot;: &quot;envoy.listener.tls_inspector&quot;,
                &quot;typedConfig&quot;: {
                    &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.listener.tls_inspector.v2.TlsInspector&quot;
                }
            },
            {
                &quot;name&quot;: &quot;envoy.listener.http_inspector&quot;,
                &quot;typedConfig&quot;: {
                    &quot;@type&quot;: &quot;type.googleapis.com/envoy.config.filter.listener.http_inspector.v2.HttpInspector&quot;
                }
            }
        ],
        &quot;listenerFiltersTimeout&quot;: &quot;1s&quot;,
        &quot;continueOnListenerFiltersTimeout&quot;: true,
        &quot;trafficDirection&quot;: &quot;INBOUND&quot;
    }
]
</code></pre><p>Check more istio practice detail at my tech blog <a href="https://imesh.club">https://imesh.club</a></p>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="/posts/f5-envoy-cloud-native/">
                <span class="button__icon">←</span>
                <span class="button__text">Infrastructure | How an application delivery veteran sees Envoy in the era of cloud native</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="/posts/f5-istio-work-together/">
                <span class="button__text">Istio | Enhancing ingress service capabilities</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2021 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


  <script src="/assets/languageSelector.js"></script>






  
</div>

</body>
</html>
